###################### mysql
# deploy MySQL on VM and test DB remote connectivity

https://www.youtube.com/watch?v=4QrQlKtluK8&t=359s
sudo apt-get update
sudo apt-get upgrade
sudo apt-get install mysql-server -y

sudo nano /etc/mysql/mysql.conf.d/mysqld.cnf

sudo systemctl restart mysql
sudo systemctl enable mysql
sudo systemctl status mysql
sudo mysql -V

sudo apt-get install iptables-persistent
# sudo iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 3306 -j ACCEPT
sudo iptables -I INPUT 5 -p tcp --dport 3306 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT
sudo netfilter-persistent save

sudo mysql
ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'S3curePassword!';
exit

mysql -u root -p

# sudo mysql_secure_installation

CREATE USER 'director'@'localhost' IDENTIFIED BY 'S3curePassword!';
GRANT ALL PRIVILEGES ON *.* TO 'director@'localhost' IDENTIFIED BY 'S3curePassword!';

ALTER USER 'director'@'localhost' IDENTIFIED WITH mysql_native_password BY 'S3curePassword!';
RENAME USER 'director'@'localhost' to 'director'@'%';

CREATE DATABASE assessment;

GRANT ALL PRIVILEGES ON *.* TO 'director'@'%';
# GRANT ALL PRIVILEGES ON *.* TO 'director'@'%' IDENTIFIED BY 'S3curePassword!';

select user, plugin, host from mysql.user;

GRANT ALL PRIVILEGES ON *.* TO 'director@'%' IDENTIFIED BY 'S3curePassword!';

CREATe USER 'director_remote@'%' identified

exit

mysql -u root -p



# to make mysql working on remote you have to install pymysql and
# edit __init__.py in the folder that contains settings.py
source /home/ubuntu/AssessmentOI/v_assessment/bin/activate
pip install pymysql
# Then, edit the init.py file in your project origin dir(the same as settings.py)
#
# add:
# import pymysql
# pymysql.install_as_MySQLdb()

